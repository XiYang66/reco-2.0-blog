---
title: åæ ‡è½¬æ¢
date: 2024-11-4
tags:
 - cesiumä¸‰ç»´åœ°å›¾
 - ä»£ç å®ç°
categories: 
 - cesiumä¸‰ç»´åœ°å›¾
---


## å±å¹•åæ ‡ è½¬ ç¬›å¡å°”åæ ‡

 X Y è¡¨ç¤ºå¯¹åº”çš„å±å¹•X Y è½´çš„åæ ‡
 ellipsoid è¡¨ç¤ºåœ°çƒæ¨¡å‹ï¼Œæ˜¯é€šè¿‡vieweræ‹¿åˆ°çš„ã€‚`viewer.scene.globe.ellipsoid`

```js
    let screenPoint = new Cesium.Cartesian2(X, Y);
    // è¿™ä¸ªåæ ‡ä¸åœ°çƒç›¸äº¤ç‚¹çš„ç¬›å¡å°”åæ ‡å¹¶è¿”å›ä¸€ä¸ªäº¤ç‚¹çš„ç¬›å¡å°”åæ ‡
    let cartesian3 = scene.camera.pickEllipsoid(screenPoint,ellipsoid);
```

## ç¬›å¡å°”åæ ‡ è½¬ åœ°ç†åæ ‡

`Cesium.Cartographic.fromCartesian()`å‡½æ•°æ˜¯å°†ç¬›å¡å°”åæ ‡è½¬æ¢æˆåœ°ç†åæ ‡

`Cesium.Math.toDegrees` å‡½æ•°ä¸»è¦ç”¨äºå°†å¼§åº¦å€¼è½¬æ¢ä¸ºè§’åº¦å€¼

```js
    let cartographic = Cesium.Cartographic.fromCartesian(cartesian3);
    let longitude = Cesium.Math.toDegrees(cartographic.longitude).toFixed(3);
    let latitude = Cesium.Math.toDegrees(cartographic.latitude).toFixed(3);
    let height = cartographic.height.toFixed(3);
```

## åº”ç”¨
> åœºæ™¯ï¼šæœ‰ä¸€ä¸ªdivç›’å­å®šä½åˆ°é¡µé¢ä¸Šï¼›æ ¹æ®ä»–çš„ä½ç½®åœ¨çƒä¸Šæ ‡ä¼šå‡ºä»–å››ä¸ªè§’çš„ç‚¹ä½ï¼›ä¾‹å¦‚ä¸‹å›¾

[![pArLKk8.md.png](https://s21.ax1x.com/2024/11/04/pArLKk8.md.png)]

### æ€è·¯

æˆ‘ä»¬é¦–å…ˆå…ˆè·å–è¿™ä¸ªdivçš„`å±å¹•åæ ‡`ç„¶åé€šè¿‡å±å¹•åæ ‡å†è½¬æ¢ä¸º`ç¬›å¡å°”`ï¼Œç„¶åå†è½¬`åœ°ç†åæ ‡`å¹¶ç»™å››ä¸ªç‚¹æ‰“ä¸Šç‚¹ï¼›

- é€šè¿‡ `DOM.getBoundingClientRect()`å‡½æ•°å¯ä»¥æ‹¿åˆ°ä»–çš„å±å¹•åæ ‡ä¿¡æ¯ï¼›
[![pArLwhF.png](https://s21.ax1x.com/2024/11/04/pArLwhF.png)](https://imgse.com/i/pArLwhF)

- ç„¶åå†æ ¹æ®å‰é¢[ğŸ‘†](#å±å¹•åæ ‡-è½¬-ç¬›å¡å°”åæ ‡)æåˆ°çš„åæ ‡è½¬æ¢ä»£ç æœ€ç»ˆè½¬æ¢æˆcesiumå¯åœ°ç†åæ ‡ç„¶åå†æ ¹æ®å››ä¸ªç‚¹çš„åæ ‡æ‰“ç‚¹å³å¯ï¼›

### ä»£ç éƒ¨åˆ†

```js
// åæ ‡è½¬æ¢
const coordTransition=(viewer)=>{
    const boxRect = box.value.getBoundingClientRect();//è·å–divçš„åæ ‡ä¿¡æ¯
    const scene = viewer.scene;//åœºæ™¯
    const camera=viewer.camera;//ç›¸æœº
    const ellipsoid = viewer.scene.globe.ellipsoid;// ä»£è¡¨åœ°çƒçš„æ¤­çƒä½“æ¨¡å‹

    const corners = [
        { x: boxRect.left, y: boxRect.top }, // å·¦ä¸Šè§’
        { x: boxRect.right, y: boxRect.top }, // å³ä¸Šè§’
        { x: boxRect.left, y: boxRect.bottom }, // å·¦ä¸‹è§’
        { x: boxRect.right, y: boxRect.bottom } // å³ä¸‹è§’
    ];

    let geographicCoords = convertToGeographic(corners, scene, camera,ellipsoid);

    // éå†æ•°ç»„å¹¶æ‰“ç‚¹
    geographicCoords.forEach(item=>{
        const latitude = item.longitude;
        const longitude = item.latitude;
        const height = item.height;

        viewer.entities.add({
            // fromDegreesï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œé«˜åº¦ï¼Œæ¤­çƒï¼Œç»“æœï¼‰ä»ä»¥åº¦ä¸ºå•ä½çš„ç»åº¦å’Œçº¬åº¦å€¼è¿”å›Cartesian3ä½ç½®
            position: Cesium.Cartesian3.fromDegrees(latitude, longitude, height),
            point: {
                // ç‚¹çš„å¤§å°ï¼ˆåƒç´ ï¼‰
                pixelSize: 5,
                // ç‚¹ä½é¢œè‰²ï¼ŒfromCssColorString å¯ä»¥ç›´æ¥ä½¿ç”¨CSSé¢œè‰²
                color: Cesium.Color.fromCssColorString('#ee0000'),
                // è¾¹æ¡†é¢œè‰²
                outlineColor: Cesium.Color.fromCssColorString('#fff'),
                // è¾¹æ¡†å®½åº¦(åƒç´ )
                outlineWidth: 2,
                // æ˜¾ç¤ºåœ¨è·ç›¸æœºçš„è·ç¦»å¤„çš„å±æ€§ï¼Œå¤šå°‘åŒºé—´å†…æ˜¯å¯ä»¥æ˜¾ç¤ºçš„
                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 150000000),
                // æ˜¯å¦æ˜¾ç¤º
                show: true
            }
        });
    });
};
// å°†å±å¹•åæ ‡>ç¬›å¡å°” ç¬›å¡å°”>åœ°ç†åæ ‡
const convertToGeographic=(screenPointsArray, scene, camera,ellipsoid)=> {
    let geographicPoints = [];

    screenPointsArray.forEach(item=>{
        // å°†å±å¹•åæ ‡è½¬æ¢ä¸ºäºŒç»´ç¬›å¡å°”åæ ‡ ç„¶ååœ¨æ ¹æ®è¿™ä¸ªåæ ‡ä¸åœ°çƒ(ellipsoid)ç›¸äº¤ç‚¹çš„ç¬›å¡å°”åæ ‡å¹¶è¿”å›ä¸€ä¸ªäº¤ç‚¹çš„ç¬›å¡å°”åæ ‡ï¼ˆCesium.Cartesian3ï¼‰
        let screenPoint = new Cesium.Cartesian2(item.x, item.y);
        let cartesian3 = scene.camera.pickEllipsoid(screenPoint,ellipsoid);

        if (cartesian3) {
            // å°†ç¬›å¡å°”åæ ‡è½¬æ¢ä¸ºåœ°ç†åæ ‡
            let cartographic = Cesium.Cartographic.fromCartesian(cartesian3);
            let longitude = Cesium.Math.toDegrees(cartographic.longitude).toFixed(3);
            let latitude = Cesium.Math.toDegrees(cartographic.latitude).toFixed(3);
            let height = cartographic.height.toFixed(3);

            geographicPoints.push({
                longitude: longitude,
                latitude: latitude,
                height: height
            });
        }
    });
    return geographicPoints;
};
```

### æ•ˆæœ
[![pArOlE6.png](https://s21.ax1x.com/2024/11/04/pArOlE6.png)](https://imgse.com/i/pArOlE6)