---
title: åæ ‡åœ°é¢é—ªçƒ
date: 2022-8-16
tags:
 - cesiumä¸‰ç»´åœ°å›¾
categories: 
 - cesiumä¸‰ç»´åœ°å›¾
---

> é€‰ä¸­åæ ‡çš„æ—¶å€™,è®©åæ ‡ä¸‹æ–¹æœ‰ä¸€ä¸ªé—ªçƒå›¾ç‰‡æ•ˆæœ

åœ¨ç‚¹å‡»äº‹ä»¶ä¸­åŠ å…¥æ·»åŠ é—ªçƒå›¾ç‰‡å‡½æ•°

```js
// ç»™å…¨å›¾ç»‘å®šäº‹ä»¶
const handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)
// ç‚¹å‡»äº‹ä»¶
handler.setInputAction((click) => {
  // æ·»åŠ å¼¹æ¡†ç‰¹æ•ˆ(çº¢è‰²é€‰ä¸­æ³¢çº¹ç‰¹æ•ˆ)
  this.addCircleRippleInit(this.viewer, lon2, lat2, 1)
})

```

é—ªçƒå›¾ç‰‡å‡½æ•°ï¼Œé€‰ä¸­æ•ˆæœ

```js
// é€‰ä¸­æ•ˆæœ
addCircleRippleInit(viewer, long, lat, height) {
  let data = {
    id: ['abcd-111', 'abcd-222'], // 2ä¸ªå®ç°åœ†å¼§æ•ˆæœçš„å®ä½“idï¼Œåé¢å¯¹è¿™2ä¸ªå®ä½“çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªidæ¥çš„
    lon: long * 1, // ç»åº¦ å°±ä¸å¤šè¯´äº†
    lat: lat * 1, // ç»´åº¦ ä¹Ÿä¸å¤šè¯´äº†
    height: height, // å› ä¸ºæ˜¯3dåœ°å›¾ï¼Œåœ°å›¾ä¸Šçš„å®ä½“ä¼šæœ‰é«˜åº¦å±æ€§ï¼Œå¯ä»¥è®¾ç½®å®ä½“çš„é«˜åº¦
    maxR: 40, // åœ†å¼§çš„æœ€å¤§åŠå¾„
    minR: 0, // æœ€å¥½ä¸º0
    deviationR: 0.3, // å·®å€¼ å·®å€¼ä¹Ÿå¤§ é€Ÿåº¦è¶Šå¿«
    eachInterval: 1000, // ä¸¤ä¸ªåœˆçš„æ—¶é—´é—´éš”
    imageUrl: require('@/assets/image/zl.jpg'),
  }

  // è°ƒç”¨ä¸Šé¢æ„é€ åœ†å¼§çš„æ–¹æ³•
  this.addCircleRipple(viewer, data)
},
// æ„å»ºåœ†å¼§æ•ˆæœ
addCircleRipple(viewer, data) {
  // console.log('ğŸš€ ~ file: No01-init.vue ~ line 288 ~ addCircleRipple ~ viewer, data', viewer, data)
  const Cesium = this.cesium
  var r1 = data.minR,
    r2 = data.minR
  // é€šè¿‡ entities.getById()æ–¹æ³•æ‰¾åˆ°è¦æ“ä½œçš„å®ä½“
  // ç§»é™¤ä¸Šä¸€æ¬¡çš„æ³¢çº¹æ•ˆæœ
  if (viewer.entities.getById(data.id[0])) {
    viewer.entities.remove(viewer.entities.getById(data.id[0]))
  }

  if (viewer.entities.getById(data.id[1])) {
    viewer.entities.remove(viewer.entities.getById(data.id[1]))
  }

  // å›è°ƒå‡½æ•°1
  function changeR1() {
    //è¿™æ˜¯callbackï¼Œå‚æ•°ä¸èƒ½å†…ä¼ 
    r1 = r1 + data.deviationR
    if (r1 >= data.maxR) {
      r1 = data.minR
    }
    return r1
  }
  // å›è°ƒå‡½æ•°2
  function changeR2() {
    r2 = r2 + data.deviationR
    if (r2 >= data.maxR) {
      r2 = data.minR
    }
    return r2
  }
  viewer.entities.add({
    id: data.id[0],
    name: '',
    position: Cesium.Cartesian3.fromDegrees(data.lon, data.lat, data.height),
    ellipse: {
      // è¿™é‡Œä¸ºä»€ä¹ˆä¸€ä¸ªæ–¹æ³•è¦å†™æˆ changeR1 changeR2
      // å› ä¸º Cesiumä¸­ä½¿ç”¨åœ†çš„æ‰©æ•£ï¼Œå¯ä»¥é‡‡ç”¨å›è°ƒå‡½æ•°æ¥è¿›è¡Œç»˜åˆ¶ï¼Œè¿™æ ·å¯ä»¥å¯ä»¥è·å¾—åŠ¨æ€æ‰©æ•£çš„æ•ˆæœã€‚ä½†æ˜¯åšçš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªé•¿åŠè½´å°äºçŸ­åŠè½´çš„æŠ¥é”™
      // åŸå› 
      // semiMinorAxiså’ŒsemiMajorAxisä½¿ç”¨åŒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”semiMajorAxiså±æ€§è¦æ—©äºsemiMinorAxiså±æ€§ï¼Œæ‰€ä»¥é€ æˆé•¿åŠè½´å°äºçŸ­åŠè½´ã€‚
      // è§£å†³æ–¹æ¡ˆï¼š
      // semiMinorAxisä½¿ç”¨å¦ä¸€ä¸ªå›è°ƒå‡½æ•°
      // å…³äºè¿™é‡Œçš„æŠ¥é”™ï¼Œå¯ä»¥çœ‹æœ€ä¸‹æ–¹çš„å‚è€ƒæ–‡ç« é‚£é‡Œ
      semiMinorAxis: new Cesium.CallbackProperty(changeR1, false),
      semiMajorAxis: new Cesium.CallbackProperty(changeR2, false),
      height: data.height,
      material: new Cesium.ImageMaterialProperty({
        image: data.imageUrl,
        repeat: new Cesium.Cartesian2(1.0, 1.0),
        transparent: true,
        color: new Cesium.CallbackProperty(function () {
          var alp = 1 - r1 / data.maxR
          return Cesium.Color.WHITE.withAlpha(alp) //entityçš„é¢œè‰²é€æ˜ å¹¶ä¸å½±å“æè´¨ï¼Œå¹¶ä¸” entityä¹Ÿä¼šé€æ˜å“¦
        }, false),
      }),
    },
  })
  setTimeout(function () {
    viewer.entities.add({
      id: data.id[1],
      name: '',
      position: Cesium.Cartesian3.fromDegrees(data.lon, data.lat, data.height),
      ellipse: {
        semiMinorAxis: new Cesium.CallbackProperty(changeR1, false),
        semiMajorAxis: new Cesium.CallbackProperty(changeR2, false),
        height: data.height,
        material: new Cesium.ImageMaterialProperty({
          image: data.imageUrl,
          repeat: new Cesium.Cartesian2(1.0, 1.0),
          transparent: true,
          color: new Cesium.CallbackProperty(function () {
            var alp = 1
            alp = 1 - r2 / data.maxR
            return Cesium.Color.WHITE.withAlpha(alp)
          }, false),
        }),
      },
    })
  }, data.eachInterval)
},
```
